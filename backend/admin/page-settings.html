<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Admin Settings - Admin Dashboard</title>
    <link rel="stylesheet" href="../../shared/navigation.css">
    <link rel="stylesheet" href="admin-style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body class="admin-page">
    <!-- Top Bar -->
    <div class="top-bar">
        <div class="top-bar-left">
            <button class="menu-toggle"><i class="fas fa-bars"></i></button>
        </div>
        <div class="top-bar-center">
            <img class="store-logo" id="store-logo" alt="Store Logo">
            <div class="top-bar-title">Admin Settings</div>
        </div>
        <div class="top-bar-right">
            <button class="icon-btn" onclick="window.location.href='../../index.html'"><i class="fas fa-home"></i></button>
            <button class="icon-btn" id="admin-logout"><i class="fas fa-sign-out-alt"></i></button>
        </div>
    </div>

    <!-- Sidebar -->
    <div class="sidebar">
        <nav class="sidebar-nav">
            <a href="dashboard.html" class="nav-item">Dashboard</a>
            <a href="orders.html" class="nav-item">Orders</a>
            <a href="crm.html" class="nav-item">CRM</a>
            <a href="gallery.html" class="nav-item">Gallery</a>
            <a href="products.html" class="nav-item">Product Studio</a>
            <a href="product-settings.html" class="nav-item">Product Settings</a>
            <a href="page-settings.html" class="nav-item">Admin Settings</a>
            <a href="../../index.html" class="nav-item">View Store</a>
        </nav>
    </div>

    <!-- Sidebar Overlay -->
    <div class="sidebar-overlay"></div>

    <!-- Main Content -->
    <div class="main-content">
        <div class="messenger-container">
            <!-- Left Side - Settings List -->
            <div class="chat-list">
                <div class="chat-header">
                    <h3>Admin Settings</h3>
                    <p style="font-size: 12px; color: #666; margin: 5px 0 0 0;">Manage your store settings</p>
                </div>
                
                <div class="chat-items">
                    <div class="chat-item" onclick="selectSetting('home-page')" data-setting="home-page">
                        <div class="chat-avatar" style="background: #3498db; color: white; display: flex; align-items: center; justify-content: center; font-weight: bold;">
                            <i class="fas fa-home"></i>
                        </div>
                        <div class="chat-info">
                            <div class="chat-name">Home Page</div>
                            <div class="chat-preview">Hero section and main content</div>
                        </div>
                    </div>
                    
                    <div class="chat-item" onclick="selectSetting('products-page')" data-setting="products-page">
                        <div class="chat-avatar" style="background: #e74c3c; color: white; display: flex; align-items: center; justify-content: center; font-weight: bold;">
                            <i class="fas fa-box"></i>
                        </div>
                        <div class="chat-info">
                            <div class="chat-name">Products Page</div>
                            <div class="chat-preview">Product catalog settings</div>
                        </div>
                    </div>
                    
                    <div class="chat-item" onclick="selectSetting('cart-page')" data-setting="cart-page">
                        <div class="chat-avatar" style="background: #f39c12; color: white; display: flex; align-items: center; justify-content: center; font-weight: bold;">
                            <i class="fas fa-shopping-cart"></i>
                        </div>
                        <div class="chat-info">
                            <div class="chat-name">Cart Page</div>
                            <div class="chat-preview">Shopping cart messages</div>
                        </div>
                    </div>
                    
                    <div class="chat-item" onclick="selectSetting('login-page')" data-setting="login-page">
                        <div class="chat-avatar" style="background: #9b59b6; color: white; display: flex; align-items: center; justify-content: center; font-weight: bold;">
                            <i class="fas fa-user"></i>
                        </div>
                        <div class="chat-info">
                            <div class="chat-name">Login Page</div>
                            <div class="chat-preview">Authentication settings</div>
                        </div>
                    </div>
                    
                    <div class="chat-item" onclick="selectSetting('order-settings')" data-setting="order-settings">
                        <div class="chat-avatar" style="background: #27ae60; color: white; display: flex; align-items: center; justify-content: center; font-weight: bold;">
                            <i class="fas fa-cog"></i>
                        </div>
                        <div class="chat-info">
                            <div class="chat-name">Order Settings</div>
                            <div class="chat-preview">Order number configuration</div>
                        </div>
                    </div>
                    
                    <div class="chat-item" onclick="selectSetting('order-management')" data-setting="order-management">
                        <div class="chat-avatar" style="background: #e67e22; color: white; display: flex; align-items: center; justify-content: center; font-weight: bold;">
                            <i class="fas fa-trash"></i>
                        </div>
                        <div class="chat-info">
                            <div class="chat-name">Order Management</div>
                            <div class="chat-preview">Delete orders and restore stock</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right Side - Settings Detail -->
            <div class="chat-detail">
                <div class="no-selection" id="no-setting-selected">
                    <i class="fas fa-cog"></i>
                    <h3>Select a Setting</h3>
                    <p>Choose a setting from the list to configure</p>
                </div>
                
                <div class="order-detail-view" id="setting-detail-view" style="display: none;">
                    <div class="detail-content">
                        <div id="setting-content">
                            <!-- Setting forms loaded here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Font Selection Modal -->
    <div id="font-modal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Select Font Family</h3>
                <button class="modal-close" onclick="closeFontModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="font-options">
                    <div class="font-option" onclick="selectFont('Arial, sans-serif')" style="font-family: Arial, sans-serif;">Arial</div>
                    <div class="font-option" onclick="selectFont('Helvetica, sans-serif')" style="font-family: Helvetica, sans-serif;">Helvetica</div>
                    <div class="font-option" onclick="selectFont('Times New Roman, serif')" style="font-family: 'Times New Roman', serif;">Times New Roman</div>
                    <div class="font-option" onclick="selectFont('Georgia, serif')" style="font-family: 'Georgia', serif;">Georgia</div>
                    <div class="font-option" onclick="selectFont('Verdana, sans-serif')" style="font-family: 'Verdana', sans-serif;">Verdana</div>
                    <div class="font-option" onclick="selectFont('Tahoma, sans-serif')" style="font-family: 'Tahoma', sans-serif;">Tahoma</div>
                    <div class="font-option" onclick="selectFont('Trebuchet MS, sans-serif')" style="font-family: 'Trebuchet MS', sans-serif;">Trebuchet MS</div>
                    <div class="font-option" onclick="selectFont('Courier New, monospace')" style="font-family: 'Courier New', monospace;">Courier New</div>
                    <div class="font-option" onclick="selectFont('Monaco, monospace')" style="font-family: 'Monaco', monospace;">Monaco</div>
                    <div class="font-option" onclick="selectFont('Lucida Console, monospace')" style="font-family: 'Lucida Console', monospace;">Lucida Console</div>
                    <div class="font-option" onclick="selectFont('Impact, sans-serif')" style="font-family: 'Impact', sans-serif;">Impact</div>
                    <div class="font-option" onclick="selectFont('Comic Sans MS, cursive')" style="font-family: 'Comic Sans MS', cursive;">Comic Sans MS</div>
                    <div class="font-option" onclick="selectFont('Palatino, serif')" style="font-family: 'Palatino', serif;">Palatino</div>
                    <div class="font-option" onclick="selectFont('Garamond, serif')" style="font-family: 'Garamond', serif;">Garamond</div>
                    <div class="font-option" onclick="selectFont('Book Antiqua, serif')" style="font-family: 'Book Antiqua', serif;">Book Antiqua</div>
                    <div class="font-option" onclick="selectFont('Calibri, sans-serif')" style="font-family: 'Calibri', sans-serif;">Calibri</div>
                    <div class="font-option" onclick="selectFont('Cambria, serif')" style="font-family: 'Cambria', serif;">Cambria</div>
                    <div class="font-option" onclick="selectFont('Franklin Gothic Medium, sans-serif')" style="font-family: 'Franklin Gothic Medium', sans-serif;">Franklin Gothic Medium</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Mobile Setting Modal -->
    <div id="mobile-setting-modal" class="mobile-modal" style="display: none;">
        <div class="mobile-modal-header">
            <button class="mobile-back-btn" onclick="closeMobileSettingModal()"><i class="fas fa-arrow-left"></i></button>
            <h3 id="mobile-setting-title">Setting Details</h3>
        </div>
        <div class="mobile-modal-content" id="mobile-setting-content">
            <!-- Mobile setting content loaded here -->
        </div>
        <div class="mobile-modal-footer">
            <button class="btn-save" onclick="saveCurrentSetting()"><i class="fas fa-save"></i> Save</button>
        </div>
    </div>

    <script type="module" src="../../shared/navigation.js"></script>
    <script type="module" src="auth-check.js"></script>
    <script type="module" src="page-settings.js"></script>
    <script>
        // Select setting function
        window.selectSetting = function(settingType) {
            // Remove active class from all items
            document.querySelectorAll('.chat-item').forEach(item => {
                item.classList.remove('active');
            });
            
            // Add active class to selected item
            document.querySelector(`[data-setting="${settingType}"]`).classList.add('active');
            
            // Show setting detail view
            document.getElementById('no-setting-selected').style.display = 'none';
            document.getElementById('setting-detail-view').style.display = 'flex';
            
            // Load content
            loadSettingContent(settingType);
        }
        
        // Load setting content
        async function loadSettingContent(settingType) {
            const content = document.getElementById('setting-content');
            
            switch(settingType) {
                case 'home-page':
                    content.innerHTML = `
                        <div class="form-section">
                            <h3>Hero Section</h3>
                            <div class="settings-group">
                                <label for="hero-title">Hero Title</label>
                                <input type="text" id="hero-title" placeholder="Welcome to Our Store">
                            </div>
                            <div class="settings-group">
                                <label for="hero-subtitle">Hero Subtitle</label>
                                <input type="text" id="hero-subtitle" placeholder="Find amazing products at great prices">
                            </div>
                            <div class="settings-group">
                                <label for="animated-title">Animated Header Text</label>
                                <input type="text" id="animated-title" placeholder="CYBEE CART">
                            </div>
                            <div class="settings-group">
                                <label for="header-font">Header Font Family</label>
                                <input type="text" id="header-font" placeholder="Arial, sans-serif" readonly onclick="openFontModal()" style="cursor: pointer;">
                            </div>
                            <button class="btn-chat" onclick="saveCurrentSetting()"><i class="fas fa-save"></i> Save</button>
                        </div>
                    `;
                    await loadSettingsData();
                    break;
                case 'products-page':
                    content.innerHTML = `
                        <div class="form-section">
                            <h3>Products Page</h3>
                            <div class="settings-group">
                                <label for="products-title">Page Title</label>
                                <input type="text" id="products-title" placeholder="Our Products">
                            </div>
                            <div class="settings-group">
                                <label for="products-subtitle">Page Subtitle</label>
                                <input type="text" id="products-subtitle" placeholder="Browse our amazing collection">
                            </div>
                            <button class="btn-chat" onclick="saveCurrentSetting()"><i class="fas fa-save"></i> Save</button>
                        </div>
                    `;
                    await loadSettingsData();
                    break;
                case 'order-settings':
                    content.innerHTML = `
                        <div class="form-section">
                            <h3>Order Configuration</h3>
                            <div class="settings-group">
                                <label for="order-prefix">Order Number Prefix</label>
                                <input type="text" id="order-prefix" placeholder="ORD" maxlength="10">
                            </div>
                            <button class="btn-chat" onclick="saveCurrentSetting()"><i class="fas fa-save"></i> Save</button>
                        </div>
                    `;
                    await loadSettingsData();
                    break;
                case 'order-management':
                    content.innerHTML = `
                        <div class="form-section">
                            <h3>Delete Orders</h3>
                            <div class="settings-group">
                                <label for="order-select">Select Order to Delete</label>
                                <select id="order-select">
                                    <option value="">Loading orders...</option>
                                </select>
                                <button type="button" id="delete-order-btn" class="btn-danger" style="margin-top: 10px;">Delete Selected Order</button>
                            </div>
                        </div>
                    `;
                    loadOrdersForManagement();
                    setupDeleteOrderButton();
                    break;
            }
        }
        
        // Load settings data from database
        async function loadSettingsData() {
            try {
                const { db } = await import('../../frontend/config/firebase-config.js');
                const { doc, getDoc } = await import('https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore.js');
                
                const settingsDoc = await getDoc(doc(db, 'settings', 'pages'));
                if (settingsDoc.exists()) {
                    const data = settingsDoc.data();
                    
                    // Populate fields if they exist and mark as saved
                    if (document.getElementById('hero-title')) {
                        document.getElementById('hero-title').value = data.heroTitle || '';
                        if (data.heroTitle) document.getElementById('hero-title').classList.add('saved');
                    }
                    if (document.getElementById('hero-subtitle')) {
                        document.getElementById('hero-subtitle').value = data.heroSubtitle || '';
                        if (data.heroSubtitle) document.getElementById('hero-subtitle').classList.add('saved');
                    }
                    if (document.getElementById('animated-title')) {
                        document.getElementById('animated-title').value = data.animatedTitle || 'CYBEE CART';
                        if (data.animatedTitle) document.getElementById('animated-title').classList.add('saved');
                    }
                    if (document.getElementById('products-title')) {
                        document.getElementById('products-title').value = data.productsTitle || '';
                        if (data.productsTitle) document.getElementById('products-title').classList.add('saved');
                    }
                    if (document.getElementById('products-subtitle')) {
                        document.getElementById('products-subtitle').value = data.productsSubtitle || '';
                        if (data.productsSubtitle) document.getElementById('products-subtitle').classList.add('saved');
                    }
                    if (document.getElementById('order-prefix')) {
                        document.getElementById('order-prefix').value = data.orderPrefix || 'ORD';
                        if (data.orderPrefix) document.getElementById('order-prefix').classList.add('saved');
                    }
                    if (document.getElementById('header-font')) {
                        document.getElementById('header-font').value = data.headerFont || 'Arial, sans-serif';
                        if (data.headerFont) document.getElementById('header-font').classList.add('saved');
                    }
                    
                    // Add focus listeners to remove saved class
                    document.querySelectorAll('.saved').forEach(field => {
                        field.addEventListener('focus', function() {
                            this.classList.remove('saved');
                        });
                    });
                }
            } catch (error) {
                console.error('Error loading settings:', error);
            }
        }
        
        // Font modal functions
        window.openFontModal = function() {
            document.getElementById('font-modal').style.display = 'flex';
        }
        
        window.closeFontModal = function() {
            document.getElementById('font-modal').style.display = 'none';
        }
        
        window.selectFont = function(fontFamily) {
            document.getElementById('header-font').value = fontFamily;
            document.getElementById('header-font').classList.remove('saved');
            closeFontModal();
        }
        
        // Save current setting
        window.saveCurrentSetting = async function() {
            try {
                const { db } = await import('../../frontend/config/firebase-config.js');
                const { doc, getDoc, setDoc } = await import('https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore.js');
                
                // Get existing data
                const settingsDoc = await getDoc(doc(db, 'settings', 'pages'));
                const existingData = settingsDoc.exists() ? settingsDoc.data() : {};
                
                // Update with current form data
                const formData = {
                    ...existingData,
                    updatedAt: new Date().toISOString()
                };
                
                // Get values from current form
                if (document.getElementById('hero-title')) formData.heroTitle = document.getElementById('hero-title').value;
                if (document.getElementById('hero-subtitle')) formData.heroSubtitle = document.getElementById('hero-subtitle').value;
                if (document.getElementById('animated-title')) formData.animatedTitle = document.getElementById('animated-title').value;
                if (document.getElementById('products-title')) formData.productsTitle = document.getElementById('products-title').value;
                if (document.getElementById('products-subtitle')) formData.productsSubtitle = document.getElementById('products-subtitle').value;
                if (document.getElementById('order-prefix')) formData.orderPrefix = document.getElementById('order-prefix').value;
                if (document.getElementById('header-font')) formData.headerFont = document.getElementById('header-font').value;
                
                await setDoc(doc(db, 'settings', 'pages'), formData);
                
                // Mark all current fields as saved
                document.querySelectorAll('#setting-content input, #setting-content textarea, #setting-content select').forEach(field => {
                    if (field.value) {
                        field.classList.add('saved');
                        field.addEventListener('focus', function() {
                            this.classList.remove('saved');
                        });
                    }
                });
                
                showNotification('Settings saved successfully!', 'success');
            } catch (error) {
                console.error('Error saving settings:', error);
                showNotification('Error saving settings', 'error');
            }
        }
    </script>
</body>
</html>