<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=0.75">
    <title>Shopping Cart - Ecommerce Store</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="sidebar-fix.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <!-- Top Bar -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top" style="z-index: 9999;">
        <div class="container-fluid">
            <button class="btn text-white me-2" type="button" data-bs-toggle="offcanvas" data-bs-target="#sidebar">
                <i class="fas fa-bars"></i>
            </button>
            <a class="navbar-brand mx-auto" href="#">
                <img class="store-logo" id="store-logo" alt="Store Logo" style="max-height: 40px; display: none;">
                <span class="top-bar-title fw-bold"></span>
            </a>
            <div class="d-flex">
                <button class="btn text-white me-2 search-btn"><i class="fas fa-search"></i></button>
                <button class="btn text-white me-2 notification-btn" id="notification-btn" title="Notifications">
                    <i class="fas fa-bell"></i>
                    <span class="badge bg-danger notification-count" id="notification-count" style="display: none; position: absolute; top: 5px; right: 5px; font-size: 0.6rem;">0</span>
                </button>
                <button class="btn text-white d-flex align-items-center cart-btn">
                    <span class="badge bg-danger me-2 cart-count" id="cart-count">0</span>
                    <i class="fas fa-shopping-cart"></i>
                </button>
            </div>
        </div>
    </nav>

    <!-- New Sidebar -->
    <div class="offcanvas offcanvas-start bg-white" tabindex="-1" id="sidebar" style="width: 300px; top: 56px;">
        <div class="offcanvas-header border-bottom">
            <h5 class="offcanvas-title">Menu</h5>
            <button type="button" class="btn-close" data-bs-dismiss="offcanvas"></button>
        </div>
        <div class="offcanvas-body p-0">
            <nav class="nav flex-column">
                <a class="nav-link d-flex align-items-center py-3 px-4" href="index.html">
                    <i class="fas fa-home me-3"></i>Home
                </a>
                <a class="nav-link d-flex align-items-center py-3 px-4" href="shopping-cart.html">
                    <i class="fas fa-shopping-cart me-3"></i>Cart
                </a>
                <a class="nav-link d-flex align-items-center py-3 px-4 auth-only" href="myorders.html">
                    <i class="fas fa-box me-3"></i>Orders
                </a>
                <a class="nav-link d-flex align-items-center py-3 px-4 auth-only" href="profile.html">
                    <i class="fas fa-user me-3"></i>Profile
                </a>
                <a class="nav-link d-flex align-items-center py-3 px-4 guest-only" href="login.html">
                    <i class="fas fa-sign-in-alt me-3"></i>Login
                </a>
                <a class="nav-link d-flex align-items-center py-3 px-4 admin-only" href="dashboard.html">
                    <i class="fas fa-cog me-3"></i>Admin
                </a>
                <a class="nav-link d-flex align-items-center py-3 px-4 text-danger auth-only" href="#" onclick="handleLogout()">
                    <i class="fas fa-sign-out-alt me-3"></i>Logout
                </a>
            </nav>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div id="cart-loading" class="position-fixed top-0 start-0 w-100 h-100 d-flex align-items-center justify-content-center" style="background: rgba(255,255,255,0.9); z-index: 9998;">
        <div class="text-center">
            <div class="spinner-border text-primary mb-3" role="status" style="width: 3rem; height: 3rem;">
                <span class="visually-hidden">Loading...</span>
            </div>
            <h5>Loading Cart...</h5>
        </div>
    </div>

    <!-- Main Content -->
    <div class="container-fluid" style="margin-top: 56px;">
        <div class="row g-4 p-4">
            <!-- Cart Items -->
            <div class="col-lg-8">
                <div class="card">
                    <div class="card-header">
                        <h4 class="mb-0" id="cart-heading">Shopping Cart</h4>
                    </div>
                    <div class="card-body" id="cart-items">
                        <!-- Cart items loaded here -->
                    </div>
                    <div class="card-footer" id="cart-total">
                        <div id="savings-badge" class="alert alert-success mb-3" style="display: none;">
                            <i class="fas fa-tag me-2"></i>
                            <strong>You saved <span id="currency-symbol-savings"></span><span id="total-savings">0.00</span>!</strong>
                        </div>
                        <div class="d-flex justify-content-between align-items-center">
                            <h5 class="mb-0">Total: <span id="currency-symbol"></span><span id="total-amount">0.00</span></h5>
                            <button id="checkout-btn" class="btn btn-primary">Proceed to Checkout</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Checkout Form -->
            <div class="col-lg-4" id="checkout-form" style="display:none;">
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0">Checkout</h5>
                    </div>
                    <div class="card-body">
                        <div class="alert alert-info">
                            <strong>Delivery to:</strong> <span id="customer-info"></span>
                        </div>
                        
                        <form id="order-form">
                            <div class="mb-3">
                                <label for="address-select" class="form-label">Delivery Address</label>
                                <select id="address-select" class="form-select" required>
                                    <option value="">Select Address</option>
                                    <option value="new">+ Add New Address</option>
                                </select>
                            </div>
                            
                            <div class="mb-3" id="address-input" style="display:none;">
                                <div class="d-flex gap-2 mb-2">
                                    <button type="button" id="detect-location-btn" class="btn btn-outline-success btn-sm"><i class="fas fa-location-arrow me-1"></i>Detect My Location</button>
                                </div>
                                <textarea id="customer-address" class="form-control" placeholder="Start typing your address..." rows="3"></textarea>
                                <div id="checkout-address-suggestions" class="list-group mt-2" style="display: none;"></div>
                                <button type="button" id="edit-address" class="btn btn-sm btn-outline-primary mt-2" style="display:none;">Edit Address</button>
                            </div>
                            
                            <button type="submit" class="btn btn-success w-100">Place Order</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <style>
        .notification-btn {
            position: relative;
        }
        
        .notification-btn.has-notifications {
            animation: bellShake 0.5s ease-in-out;
        }
        
        @keyframes bellShake {
            0%, 100% { transform: rotate(0deg); }
            25% { transform: rotate(-10deg); }
            75% { transform: rotate(10deg); }
        }
    </style>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script type="module" src="navigation.js"></script>
    <script type="module" src="cart-manager.js"></script>
    <script src="currency.js"></script>
    <script>
        // Fallback functions
        if (typeof loadCurrency === 'undefined') {
            window.loadCurrency = () => Promise.resolve('$');
        }
        if (typeof formatPrice === 'undefined') {
            window.formatPrice = (amount) => `${getCurrentCurrency()}${parseFloat(amount || 0).toFixed(2)}`;
        }
        if (typeof getCurrentCurrency === 'undefined') {
            window.getCurrentCurrency = () => '$';
        }

        // Cart display
        async function displayCart() {
            console.log('\n=== DISPLAY CART DEBUG ===');
            console.log('1. Function started');
            console.log('2. window.cartManager:', window.cartManager);
            console.log('3. cartManager.currentUser:', window.cartManager?.currentUser);
            console.log('4. cartManager.tempCart:', window.cartManager?.tempCart);
            
            try {
                await loadCurrency();
            } catch (error) {
                console.log('Currency error:', error);
            }
            
            let cart = [];
            try {
                if (window.cartManager) {
                    console.log('5. Getting cart from manager...');
                    cart = await window.cartManager.getCart();
                    console.log('6. Cart from manager:', cart);
                } else {
                    console.log('5. No cart manager, using localStorage');
                    cart = JSON.parse(localStorage.getItem('cart') || '[]');
                    console.log('6. Cart from localStorage:', cart);
                }
            } catch (error) {
                console.log('ERROR getting cart:', error);
                cart = [];
            }
            
            const cartItems = document.getElementById('cart-items');
            const totalAmount = document.getElementById('total-amount');
            const cartCount = document.getElementById('cart-count');
            
            console.log('DEBUG: DOM elements found:', !!cartItems, !!totalAmount, !!cartCount);
            
            // Hide loading overlay
            const loadingOverlay = document.getElementById('cart-loading');
            if (loadingOverlay) {
                console.log('DEBUG: Removing loading overlay');
                loadingOverlay.remove();
            } else {
                console.log('DEBUG: Loading overlay not found');
            }
            
            if (cartCount) {
                const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
                cartCount.textContent = totalItems;
                cartCount.style.display = totalItems > 0 ? 'inline' : 'none';
            }
            
            console.log('7. Cart display completed, items shown:', cart.length);
            console.log('=== DISPLAY CART DEBUG END ===\n');
            
            if (cart.length === 0) {
                cartItems.innerHTML = '<div class="text-center py-5"><p class="mb-3">Your cart is empty.</p><button onclick="window.location.href=\'index.html\'" class="btn btn-outline-primary">Continue Shopping</button></div>';
                document.getElementById('cart-total').style.display = 'none';
                document.getElementById('checkout-form').style.display = 'none';
                return;
            }
            
            document.getElementById('cart-heading').style.display = 'block';
            document.getElementById('cart-total').style.display = 'block';
            
            cartItems.innerHTML = cart.map(item => {
                const unitPrice = item.originalPrice || item.price;
                const finalUnitPrice = item.price;
                const discount = item.discount || 0;
                const discountType = item.discountType || 'percentage';
                const vatPercent = item.vat || 0;
                
                let discountAmount = 0;
                if (discount > 0 && item.originalPrice) {
                    discountAmount = unitPrice - finalUnitPrice;
                }
                
                const subtotal = finalUnitPrice * item.quantity;
                const grossAmount = subtotal;
                const vatAmount = vatPercent > 0 ? grossAmount - (grossAmount / (1 + vatPercent / 100)) : 0;
                const netAmount = grossAmount - vatAmount;
                const totalWithVat = grossAmount;
                
                return `
                <div class="border-bottom py-3">
                    <div class="d-flex align-items-start">
                        <img src="${item.image || 'https://via.placeholder.com/80x80'}" alt="${item.name}" class="rounded me-3" style="width: 80px; height: 80px; object-fit: cover;">
                        <div class="flex-grow-1">
                            <h6 class="mb-2">${item.name}</h6>
                            <div class="small">
                                <div class="mb-1"><strong>${(item.unit || 'pcs').toUpperCase()}</strong> | <strong>${formatPrice(unitPrice)}</strong> ${discount > 0 ? `| Discount: <strong class="text-danger">${formatPrice(discountAmount)} ${discountType === 'percentage' ? `(${discount}%)` : ''}</strong>` : ''} | Rate After Discount: <strong>${formatPrice(finalUnitPrice)}</strong> ${vatPercent > 0 ? `| VAT ${vatPercent}%: <strong>${formatPrice(vatAmount)}</strong> | Net: <strong>${formatPrice(netAmount)}</strong>` : ''}</div>
                            </div>
                        </div>
                        <div class="text-end">
                            <div class="d-flex align-items-center mb-2">
                                <button class="btn btn-sm btn-outline-secondary" onclick="changeQuantity('${item.id}', -1)">-</button>
                                <span class="mx-2">${item.quantity}</span>
                                <button class="btn btn-sm btn-outline-secondary" onclick="changeQuantity('${item.id}', 1)">+</button>
                            </div>
                            <button class="btn btn-sm btn-link text-danger p-0" onclick="removeItem('${item.id}')">Remove</button>
                        </div>
                    </div>
                    <div class="text-end mt-2">
                        <div class="fw-bold h6">Total with VAT: ${formatPrice(totalWithVat)}</div>
                    </div>
                </div>
            `;
            }).join('');
            
            const total = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            totalAmount.textContent = total.toFixed(2);
            
            const currencySymbol = document.getElementById('currency-symbol');
            const currencySymbolSavings = document.getElementById('currency-symbol-savings');
            if (currencySymbol) {
                currencySymbol.textContent = getCurrentCurrency();
            }
            if (currencySymbolSavings) {
                currencySymbolSavings.textContent = getCurrentCurrency();
            }
        }
        
        // Cart functions
        async function changeQuantity(productId, change) {
            console.log('changeQuantity called:', productId, change);
            try {
                if (window.cartManager) {
                    const cart = await window.cartManager.getCart();
                    const item = cart.find(item => item.id === productId);
                    if (item) {
                        const newQuantity = item.quantity + change;
                        console.log('Updating quantity to:', newQuantity);
                        await window.cartManager.updateQuantity(productId, newQuantity);
                        await displayCart();
                    }
                } else {
                    console.log('No cart manager available');
                }
            } catch (error) {
                console.error('Error changing quantity:', error);
            }
        }
        
        async function removeItem(productId) {
            console.log('removeItem called:', productId);
            try {
                if (window.cartManager) {
                    await window.cartManager.removeFromCart(productId);
                    await displayCart();
                } else {
                    console.log('No cart manager available');
                }
            } catch (error) {
                console.error('Error removing item:', error);
            }
        }
        
        window.changeQuantity = changeQuantity;
        window.removeItem = removeItem;
        

        
        // Checkout functionality
        document.addEventListener('click', async (e) => {
            if (e.target.id === 'checkout-btn') {
                const cart = window.cartManager ? await window.cartManager.getCart() : [];
                if (cart.length === 0) {
                    alert('Your cart is empty');
                    return;
                }
                
                // Check if user is logged in and load profile
                try {
                    const { auth, db } = await import('./firebase-config.js');
                    const { doc, getDoc } = await import('https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore.js');
                    
                    if (!auth.currentUser) {
                        showLoginModal();
                        return;
                    }
                    
                    // Load user profile for checkout
                    const userDoc = await getDoc(doc(db, 'users', auth.currentUser.uid));
                    const userData = userDoc.exists() ? userDoc.data() : {};
                    
                    // Update customer info
                    document.getElementById('customer-info').textContent = userData.name || auth.currentUser.email;
                    
                    // Populate address dropdown
                    const addressSelect = document.getElementById('address-select');
                    addressSelect.innerHTML = '<option value="">Select Address</option>';
                    
                    if (userData.addresses?.length > 0) {
                        userData.addresses.forEach(address => {
                            const option = document.createElement('option');
                            option.value = address;
                            option.textContent = address.length > 50 ? address.substring(0, 50) + '...' : address;
                            addressSelect.appendChild(option);
                        });
                    }
                    
                    if (userData.address) {
                        const option = document.createElement('option');
                        option.value = userData.address;
                        option.textContent = 'Default: ' + (userData.address.length > 40 ? userData.address.substring(0, 40) + '...' : userData.address);
                        addressSelect.appendChild(option);
                    }
                    
                    addressSelect.innerHTML += '<option value="new">+ Add New Address</option>';
                    
                } catch (error) {
                    showLoginModal();
                    return;
                }
                
                document.getElementById('checkout-form').style.display = 'block';
                e.target.style.display = 'none';
            }
        });
        
        // Show login modal
        function showLoginModal() {
            const modal = new bootstrap.Modal(document.getElementById('loginModal'));
            modal.show();
        }
        
        // Handle order form submission
        document.addEventListener('submit', async (e) => {
            if (e.target.id === 'order-form') {
                e.preventDefault();
                
                const addressSelect = document.getElementById('address-select');
                const customerAddress = document.getElementById('customer-address');
                
                if (!addressSelect.value) {
                    alert('Please select a delivery address');
                    return;
                }
                
                if (addressSelect.value === 'new' && !customerAddress.value.trim()) {
                    alert('Please enter your delivery address');
                    return;
                }
                
                const submitBtn = e.target.querySelector('button[type="submit"]');
                submitBtn.disabled = true;
                submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-1"></i>Placing Order...';
                
                try {
                    const { auth, db } = await import('./firebase-config.js');
                    const { collection, addDoc, doc, getDoc, updateDoc } = await import('https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore.js');
                    
                    const cart = await window.cartManager.getCart();
                    const total = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
                    
                    // Get user data
                    const userDoc = await getDoc(doc(db, 'users', auth.currentUser.uid));
                    const userData = userDoc.exists() ? userDoc.data() : {};
                    
                    const deliveryAddress = addressSelect.value === 'new' ? customerAddress.value : addressSelect.value;
                    
                    // Create order
                    const orderData = {
                        customerInfo: {
                            name: userData.name || auth.currentUser.email,
                            email: auth.currentUser.email,
                            phone: userData.phone || 'N/A',
                            address: deliveryAddress
                        },
                        items: cart,
                        total: total,
                        status: 'pending',
                        orderDate: new Date().toISOString(),
                        userId: auth.currentUser.uid
                    };
                    
                    const orderRef = await addDoc(collection(db, 'orders'), orderData);
                    
                    // Clear cart
                    await window.cartManager.clearCart();
                    
                    // Redirect to order confirmation
                    window.location.href = `order-confirmation.html?orderId=${orderRef.id}`;
                    
                } catch (error) {
                    console.error('Error placing order:', error);
                    alert('Error placing order. Please try again.');
                    submitBtn.disabled = false;
                    submitBtn.innerHTML = 'Place Order';
                }
            }
        });
        
        // Handle address selection
        document.addEventListener('change', (e) => {
            if (e.target.id === 'address-select') {
                const addressInput = document.getElementById('address-input');
                const customerAddress = document.getElementById('customer-address');
                
                if (e.target.value === 'new') {
                    addressInput.style.display = 'block';
                    customerAddress.value = '';
                    customerAddress.focus();
                } else if (e.target.value) {
                    addressInput.style.display = 'block';
                    customerAddress.value = e.target.value;
                } else {
                    addressInput.style.display = 'none';
                }
            }
        });
        
        // Auto-detect address in checkout
        let checkoutAddressTimeout;
        function setupCheckoutAddressDetection() {
            const addressInput = document.getElementById('customer-address');
            const suggestionsDiv = document.getElementById('checkout-address-suggestions');
            
            if (!addressInput || !suggestionsDiv) return;
            
            addressInput.addEventListener('input', (e) => {
                clearTimeout(checkoutAddressTimeout);
                const query = e.target.value.trim();
                
                if (query.length < 3) {
                    suggestionsDiv.style.display = 'none';
                    return;
                }
                
                checkoutAddressTimeout = setTimeout(async () => {
                    try {
                        const response = await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(query)}&limit=5&addressdetails=1`);
                        const results = await response.json();
                        
                        if (results.length > 0) {
                            suggestionsDiv.innerHTML = results.map(result => {
                                const displayName = result.display_name.length > 80 ? 
                                    result.display_name.substring(0, 80) + '...' : result.display_name;
                                return `
                                    <button type="button" class="list-group-item list-group-item-action" onclick="selectCheckoutAddress('${result.display_name.replace(/'/g, "\\'")}')">  
                                        <i class="fas fa-map-marker-alt me-2"></i>${displayName}
                                    </button>
                                `;
                            }).join('');
                            suggestionsDiv.style.display = 'block';
                        } else {
                            suggestionsDiv.style.display = 'none';
                        }
                    } catch (error) {
                        console.error('Address search error:', error);
                        suggestionsDiv.style.display = 'none';
                    }
                }, 500);
            });
        }
        
        window.selectCheckoutAddress = function(address) {
            document.getElementById('customer-address').value = address;
            document.getElementById('checkout-address-suggestions').style.display = 'none';
        }
        
        // Detect current location
        window.detectCurrentLocation = function() {
            const detectBtn = document.getElementById('detect-location-btn');
            const addressInput = document.getElementById('customer-address');
            
            if (!navigator.geolocation) {
                alert('Geolocation is not supported by this browser.');
                return;
            }
            
            // Confirm before requesting location
            if (!confirm('This will request access to your location to auto-fill your address. Click OK to allow when prompted by your browser.')) {
                return;
            }
            
            detectBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-1"></i>Detecting...';
            detectBtn.disabled = true;
            
            navigator.geolocation.getCurrentPosition(
                async (position) => {
                    try {
                        const lat = position.coords.latitude;
                        const lon = position.coords.longitude;
                        
                        // Reverse geocoding to get address from coordinates
                        const response = await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lon}&addressdetails=1`);
                        const data = await response.json();
                        
                        if (data && data.display_name) {
                            addressInput.value = data.display_name;
                            detectBtn.innerHTML = '<i class="fas fa-check me-1"></i>Location Detected';
                            detectBtn.className = 'btn btn-success btn-sm';
                        } else {
                            throw new Error('Address not found');
                        }
                    } catch (error) {
                        console.error('Reverse geocoding error:', error);
                        alert('Could not get address from your location. Please enter manually.');
                        detectBtn.innerHTML = '<i class="fas fa-location-arrow me-1"></i>Detect My Location';
                        detectBtn.className = 'btn btn-outline-success btn-sm';
                    }
                    detectBtn.disabled = false;
                },
                (error) => {
                    let message = 'Please allow location access when prompted by your browser, then try again.';
                    if (error.code === error.TIMEOUT) {
                        message = 'Location request timed out. Please try again.';
                    } else if (error.code === error.POSITION_UNAVAILABLE) {
                        message = 'Location unavailable. Please enter address manually.';
                    }
                    alert(message);
                    detectBtn.innerHTML = '<i class="fas fa-location-arrow me-1"></i>Detect My Location';
                    detectBtn.disabled = false;
                },
                {
                    enableHighAccuracy: true,
                    timeout: 10000,
                    maximumAge: 300000
                }
            );
        }
        
        // Handle login modal button
        document.addEventListener('DOMContentLoaded', () => {
            const proceedBtn = document.getElementById('proceedToLogin');
            if (proceedBtn) {
                proceedBtn.addEventListener('click', () => {
                    localStorage.setItem('redirectAfterLogin', 'shopping-cart.html');
                    window.location.href = 'login.html';
                });
            }
            
            // Setup address detection when checkout form is shown
            const observer = new MutationObserver(() => {
                const checkoutForm = document.getElementById('checkout-form');
                if (checkoutForm && checkoutForm.style.display !== 'none') {
                    setupCheckoutAddressDetection();
                    
                    // Setup detect location button
                    const detectBtn = document.getElementById('detect-location-btn');
                    if (detectBtn && !detectBtn.onclick) {
                        detectBtn.onclick = detectCurrentLocation;
                    }
                }
            });
            observer.observe(document.body, { childList: true, subtree: true, attributes: true });
        });

        document.addEventListener('DOMContentLoaded', async () => {
            console.log('=== CART DEBUG START ===');
            console.log('DOM loaded, starting cart display');
            
            // Wait for cart manager to be available
            let attempts = 0;
            while (!window.cartManager && attempts < 10) {
                console.log('Waiting for cart manager... attempt', attempts + 1);
                await new Promise(resolve => setTimeout(resolve, 100));
                attempts++;
            }
            
            console.log('window.cartManager exists:', !!window.cartManager);
            console.log('localStorage cart:', localStorage.getItem('cart'));
            console.log('localStorage guest_cart:', localStorage.getItem('guest_cart'));
            console.log('All localStorage keys:', Object.keys(localStorage));
            displayCart();
        });
        
        // Fallback to hide loading overlay after 3 seconds
        setTimeout(() => {
            const loadingOverlay = document.getElementById('cart-loading');
            if (loadingOverlay) {
                console.log('Fallback: Removing cart loading overlay');
                loadingOverlay.remove();
            }
        }, 3000);
        
        // Also try to display cart after a short delay
        setTimeout(() => {
            if (document.getElementById('cart-loading')) {
                console.log('Fallback: Forcing cart display');
                displayCart();
            }
        }, 1000);

    </script>
    
    <!-- Login Required Modal -->
    <div class="modal fade" id="loginModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Login Required</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body text-center">
                    <i class="fas fa-lock fa-3x text-primary mb-3"></i>
                    <p>Please login to proceed with checkout.</p>
                    <p class="text-muted small">Your cart will be preserved during login.</p>
                </div>
                <div class="modal-footer justify-content-center">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Continue Shopping</button>
                    <button type="button" class="btn btn-primary" id="proceedToLogin">Login Now</button>
                </div>
            </div>
        </div>
    </div>
</body>
</html>